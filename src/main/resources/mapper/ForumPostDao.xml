<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tech.ufun.forum.mapper.ForumPostMapper">

    <resultMap type="ForumPost" id="ForumPostMap">
        <id property="id" column="id" jdbcType="INTEGER"/>
        <result property="postId" column="post_id" jdbcType="VARCHAR"/>
        <result property="topicId" column="topic_id" jdbcType="VARCHAR"/>
        <result property="topic" column="topic" jdbcType="VARCHAR"/>
        <result property="topicKey" column="topic_key" jdbcType="VARCHAR"/>
        <result property="author" column="author" jdbcType="VARCHAR"/>
        <result property="authorAvatar" column="author_avatar" jdbcType="VARCHAR"/>
        <result property="authorId" column="author_id" jdbcType="VARCHAR"/>
        <result property="subject" column="subject" jdbcType="VARCHAR"/>
        <result property="content" column="content" jdbcType="VARCHAR"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="isTop" column="is_top" jdbcType="INTEGER"/>
        <result property="isEssence" column="is_essence" jdbcType="INTEGER"/>
        <result property="viewCount" column="view_count" jdbcType="INTEGER"/>
        <result property="replyCount" column="reply_count" jdbcType="INTEGER"/>
    </resultMap>

    <!--查询单个-->
    <select id="findById" resultMap="ForumPostMap">
        select
          id, post_id, topic_id, topic, topic_key, author, author_avatar, author_id, subject, content, create_time, is_top, is_essence, view_count, reply_count
        from forum_post
        where post_id = #{postId}
    </select>

    <!--通过实体作为筛选条件查询-->
    <select id="findAll" resultMap="ForumPostMap">
        select
          id, post_id, topic_id, topic, topic_key, author, author_avatar, author_id, subject, create_time, is_top, is_essence, view_count, reply_count
        from forum_post
        <where>
            <if test="topicId != null and topicId != ''">
                and topic_id = #{topicId}
            </if>
            <if test="topic != null and topic != ''">
                and topic like '%#{topic}%'
            </if>
            <if test="topicKey != null and topicKey != ''">
                and topic_key = #{topicKey}
            </if>
            <if test="author != null and author != ''">
                and author like '%#{author}%'
            </if>
            <if test="authorId != null and authorId != ''">
                and author_id = #{authorId}
            </if>
            <if test="subject != null and subject != ''">
                and subject like '%#{subject}%'
            </if>
            <if test="isTop != null and isTop != -1">
                and is_top = #{isTop}
            </if>
            <if test="isEssence != null and isEssence != -1">
                and is_essence = #{isEssence}
            </if>
        </where>
    </select>

    <!--新增所有列-->
    <insert id="insert" parameterType="ForumPost" useGeneratedKeys="true" keyProperty="id">
        insert into forum_post(
        <if test="postId != null and postId != ''">post_id,</if>
        <if test="topicId != null and topicId != ''">topic_id,</if>
        <if test="topic != null and topic != ''">topic,</if>
        <if test="topicKey != null and topicKey != ''">topic_key,</if>
        <if test="author != null and author != ''">author,</if>
        <if test="authorAvatar != null and authorAvatar != ''">author_avatar,</if>
        <if test="authorId != null and authorId != ''">author_id,</if>
        <if test="subject != null and subject != ''">subject,</if>
        <if test="content != null and content != ''">content,</if>
        <if test="isTop != null">is_top,</if>
        <if test="isEssence != null">is_essence,</if>
        <if test="viewCount != null">view_count,</if>
        <if test="replyCount != null">reply_count,</if>
        create_time
        )values(
        <if test="postId != null and postId != ''">#{postId},</if>
        <if test="topicId != null and topicId != ''">#{topicId},</if>
        <if test="topic != null and topic != ''">#{topic},</if>
        <if test="topicKey != null and topicKey != ''">#{topicKey},</if>
        <if test="author != null and author != ''">#{author},</if>
        <if test="authorAvatar != null and authorAvatar != ''">#{authorAvatar},</if>
        <if test="authorId != null and authorId != ''">#{authorId},</if>
        <if test="subject != null and subject != ''">#{subject},</if>
        <if test="content != null and content != ''">#{content},</if>
        <if test="isTop != null">#{isTop},</if>
        <if test="isEssence != null">#{isEssence},</if>
        <if test="viewCount != null">#{viewCount},</if>
        <if test="replyCount != null">#{replyCount},</if>
        sysdate()
        )
    </insert>

    <!--通过主键修改数据-->
    <update id="update">
        update forum_post
        <set>
            <if test="topicId != null and topicId != ''">
                topic_id = #{topicId},
            </if>
            <if test="topic != null and topic != ''">
                topic = #{topic},
            </if>
            <if test="topicKey != null and topicKey != ''">
                topic_key = #{topicKey},
            </if>
            <if test="author != null and author != ''">
                author = #{author},
            </if>
            <if test="authorAvatar != null and authorAvatar != ''">
                author_avatar = #{authorAvatar},
            </if>
            <if test="authorId != null and authorId != ''">
                author_id = #{authorId},
            </if>
            <if test="subject != null and subject != ''">
                subject = #{subject},
            </if>
            <if test="content != null and content != ''">
                content = #{content},
            </if>
            <if test="createTime != null">
                create_time = #{createTime},
            </if>
            <if test="isTop != null">
                is_top = #{isTop},
            </if>
            <if test="isEssence != null">
                is_essence = #{isEssence},
            </if>
            <if test="viewCount != null">
                view_count = #{viewCount},
            </if>
            <if test="replyCount != null">
                reply_count = #{replyCount},
            </if>
        </set>
        where post_id = #{postId}
    </update>

    <!--通过主键删除-->
    <delete id="deleteById">
        delete from forum_post where post_id = #{postId}
    </delete>

</mapper>